
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <meta name="google-signin-client_id" content="879223745487-13ttaoug88fv6goh1k0q163jp1cq65ue.apps.googleusercontent.com">
  </head>

<body style="background-color:aliceblue;">


<!-- login -->
  <div id="login-page" >
    <form id="login-form">
      <section id="landing" class="container">
       
        <div class="d-flex justify-content-center align-items-center" style="height: 100vh;"  >
          <div class="p-5 bg-light shadow" style="width: auto; height: auto; border-radius: 10px; background-color: yellow;">
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control">
                    </div>
                    <button type="submit " class="btn btn-primary">Login</button>
                </form>
                <button id= "btn-register" class="btn btn-danger">register</button> <br> <br>
                <div class="g-signin2" data-onsuccess="onSignIn"></div>
            </div>
        </div>
    </section>
    </form>
   
  </div>

  
  <!-- register -->

    <form id="register-form"  >
      <section id="landing" class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-4">
                <form  onsubmit="login(event)">
                  <h2>Create New Account</h2>
                  <div class="form-group">
                    <label for="name">Name</label>
                    <input type="name" name="name" id="registname" class="form-control">
                </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="registemail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="registpassword" class="form-control">
                    </div>
                    <button type="submit " class="btn btn-primary" >register</button>
                </form>
               
            </div>
        </div>
    </section>
    </form>


<!-- edit -->
<button id= "btn-logout" class="btn btn-danger" onclick="logout()">Logout</button>
    <div id="edit"></div>
     <div id ="quote"> <h2><i> </i></h2>
      </div>
  <!-- add -->
  
      <div id="list-kanban" class="row row-cols-1 row-cols-md-3" ></div>
   
     
      
      <script src="https://apis.google.com/js/platform.js" async defer></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script>
    
    function showlogin () {
      $("#login-page").show()
      $("#form-add").hide()
      $("#edit").hide()
      $("#register-form").hide()
      $("#show").hide()
      $("#btn-logout").hide()
      $("#list-todos").hide()
      $("#quote").hide()
     

    }
    function showMainPage (){
      quote()
      $("#login-page").hide()
      $("#edit").hide()
      $("#register-form").hide()
      $("#btn-logout").show()
      fetchData()
      $("#form-add").show()
     
    }

    function showRegister() {
      $("#login-page").hide()
      $("#form-add").hide()
      $("#edit").hide()
      $("#show").hide()
      $("#btn-logout").show()
      $("#fetchData").hide()
      $('#register-form').show()
      $("#quote").hide()

    }

    function login (){
        const email = $("#email").val()
        const password = $("#password").val()
        console.log(email,password)
        $.ajax({
          
          url: "https://fancy-todos-ym.herokuapp.com/login",
          method: "POST",
          data: { 
            email,
            password}
        })
        .done(response => {
          localStorage.setItem('access_token',response.access_token)
          console.log(response)
          showMainPage()
        })
        .fail((xHR, textStatus)  => {
          console.log(  xHR,textStatus );
        })
        .always(()=>{
          $("#email").val()
          $("#password").val()


        })
      
    }
    
    function register() {
      
      const namae = $('#registname').val()
      const email = $('#registemail').val()
      const password = $('#registpassword').val()
      console.log(email, password);
      $.ajax({
        method: "POST",
        url: "https://fancy-todos-ym.herokuapp.com/register",
        data: {
          namae,
          email,
          password
        }
      })
        .done(response=> {
          console.log(response)
          localStorage.clear()
          showlogin () 
        })
        .fail((xhr, textStatus) => {
          console.log(xhr);
        })
        .always(_ => {
          $('#registname').val()
          $('#registemail').val("")
          $('#registpassword').val("")
        })
    }

    function logout (e){
      var auth2 = gapi.auth2.getAuthInstance();
       auth2.signOut().then(function () {
          console.log('User signed out.');
       });
      localStorage.clear()
    
      showlogin ()
    }
    function onSignIn(googleUser) {
      let googleToken = googleUser.getAuthResponse().id_token;
      console.log(googleToken)
      var profile = googleUser.getBasicProfile();
      console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
      console.log('Name: ' + profile.getName());
      console.log('Image URL: ' + profile.getImageUrl());
      console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
      $.ajax({
          
          url: "https://fancy-todos-ym.herokuapp.com/googleLogin",
          method:"POST",
          data: { 
            googleToken
          }
        })
        .done(response => {
          console.log('masuk done')
          localStorage.setItem('access_token',response.access_token)
          console.log(response)
          showMainPage()
        })
        .fail((xHR, textStatus)  => {
          console.log('masuk fail')
          console.log(  xHR,textStatus );
        })
       
    }
    
    

     $(document).ready(function(){
       if (localStorage.getItem('access_token')){
         showMainPage()

         
       }
       else {
        showlogin ()
     
       }
       $("#form-add").on("submit",function(e){
        e.preventDefault();
      showMainPage()
  
       })
       $('#btn-register').on('click', (e) => {
        e.preventDefault();
        showRegister();
      })

      $('#register-form').on("submit", (e) => {
          e.preventDefault();
          register()
      })
       $("#login-form").on("submit",function(e){
        e.preventDefault()
        login()
      })

  });

  
  </script>
</body>
</html>